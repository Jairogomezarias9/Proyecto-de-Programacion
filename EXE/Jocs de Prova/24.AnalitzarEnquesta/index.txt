# Joc de Prova - Cas d'ús #24 Analitzar Enquesta

Objecte de la prova:
Cas d'ús: Analitzar Enquesta.
Es prova la funcionalitat d'executar anàlisi de clustering sobre les respostes d'una enquesta per identificar grups d'usuaris amb patrons de resposta similars. El sistema aplica algorismes de clustering (K-Means, K-Means++ o K-Medoids), calcula mètriques de qualitat (Silhouette), genera perfils per cada cluster i els assigna als usuaris participants.

Fitxers de dades necessaris:
Per executar les proves, cal copiar manualment TOT el contingut de fitxers_dades/ a ../../../../dades/.
- fitxers_dades/enquestes/enc_completa/enquesta.json: Enquesta amb 5 preguntes de diferents tipus i 5 participants.
- fitxers_dades/enquestes/enc_completa/preguntes/: Directori amb les 5 preguntes (p1.json a p5.json).
- fitxers_dades/enquestes/enc_completa/respostes/: Directori amb les respostes dels 5 usuaris (TestUser1.json a TestUser5.json).
- fitxers_dades/enquestes/enc_un_participant/enquesta.json: Enquesta amb 2 preguntes i 1 sol participant (per proves d'error).
- fitxers_dades/enquestes/enc_un_participant/preguntes/: Directori amb les 2 preguntes (p1.json i p2.json).
- fitxers_dades/enquestes/enc_un_participant/respostes/: Directori amb la resposta de TestUser1.json.
- fitxers_dades/enquestes/enc_buida/enquesta.json: Enquesta buida sense cap participant (per proves d'error).
- fitxers_dades/enquestes/enc_buida/preguntes/: Directori amb les 2 preguntes (p1.json i p2.json).
- fitxers_dades/enquestes/enc_buida/respostes/: Directori buit (sense cap resposta).
- fitxers_dades/usuaris/TestUser1.json: Usuari "TestUser1" (creador de l'enquesta), amb contrasenya: "password123".
- fitxers_dades/usuaris/TestUser2.json a TestUser5.json: Usuaris participants, amb contrasenya: "password123".

Credencials de login:
- Usuari: TestUser1 (creador de l'enquesta)
- Contrasenya: password123

El sistema utilitza internament per a la persistència:
- perfils/index.json: Índex de perfils generats amb metadades bàsiques.
- perfils/{id_perfil}.json: Fitxer individual per cada perfil generat amb totes les dades del clustering.
- usuaris/{username}.json: Actualitzat amb el perfil assignat a cada usuari (camp 'perfils').
- enquestes/enc_completa/respostes/: Respostes utilitzades per vectoritzar i fer el clustering.

Valors estudiats:
Es realitzen proves de caixa negra (Black Box) centrades en les particions d'equivalència i valors límit definits per les regles de negoci del domini.

Conjunts de dades de comportament homogeni:
1. Analitzar enquesta amb K=2 i K-Means++ (Cas d'èxit):
   - Precondicions:
     * Existeix l'enquesta 'enc_completa' amb 5 participants que han respost.
     * L'usuari TestUser1 és el creador de l'enquesta.
   - Paràmetres:
     * ID Enquesta: enc_completa
     * Nombre de clusters (K): 2
     * Algorisme: K-Means++
     * Iteracions màximes: 100
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_completa' de la llista.
      4. Clic al botó "Analitzar Enquesta".
      5. Seleccionar: Manual(tu esculls k)
      6. Introduir valor de k (nombre de clusters): 2
      7. Seleccionar algorisme: K-Means++
      8. Clic al botó "Analitzar".
      9. Resultat esperat: 
         - Aparició de finestra amb els resultats del clustering.
         - Es mostren 2 clusters amb les seves característiques.
         - Es mostra el coeficient Silhouette global (entre -1 i 1).
         - Cada cluster mostra: mida, perfil característic, usuari representant.
         - Missatge de confirmació: "Anàlisi completada i perfils assignats!".

2. Analitzar enquesta amb K=3 i K-Medoids (Cas d'èxit):
   - Precondicions: Mateix que cas 1.
   - Paràmetres:
     * Nombre de clusters (K): 3
     * Algorisme: K-Medoids
     * Iteracions màximes: 100
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_completa' de la llista.
      4. Clic al botó "Analitzar Enquesta".
      5. Seleccionar: Manual(tu esculls k)
      6. Introduir valor de k (nombre de clusters): 3
      7. Seleccionar algorisme: K-Medoids
      8. Clic al botó "Analitzar".
      9. Resultat esperat: Es generen 3 clusters amb medoides reals del dataset.

3. Analitzar enquesta amb optimització automàtica de K (Cas d'èxit):
   - Precondicions: Mateix que cas 1.
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_completa' de la llista.
      4. Clic al botó "Analitzar Enquesta".
      5. Seleccionar: Automàtic(millor k segons silhouette)
      6. Introduir rang de K: mínim=2, màxim=4
      7. Seleccionar algorisme: K-Means++
      8. Clic al botó "Analitzar".
      9. Resultat esperat:
         - El sistema prova diferents k.
         - Es selecciona automàticament el K amb millor Silhouette.
         - Es mostra la k més optima per Silhouette.
         - S'executa l'anàlisi amb el K òptim.

4. Consultar anàlisi prèviament realitzada (Cas d'èxit):
   - Precondicions: S'ha executat prèviament una anàlisi sobre 'enc_completa'.
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_completa' de la llista.
      4. Clic al botó "Veure Analisi".
      5. Resultat esperat:
         - Es mostra l'anàlisi guardada sense recalcular.
         - Es mostra la mateixa informació: clusters, Silhouette, perfils.
         - Operació instantània (sense càlcul).

5. K<2 (Valors límit/invàlids):
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_completa' de la llista.
      4. Clic al botó "Analitzar Enquesta".
      5. Seleccionar: Manual(tu esculls k)
      6. Intentar introduir un valor de k menor que 2 (0 o 1).
      7. Resultat esperat: El programa no permet introduir un valor inferior a 2. La interfície valida automàticament que k ≥ 2.

6. K superior al nombre de participants (Valors límit/invàlids):
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_completa' de la llista (5 participants).
      4. Clic al botó "Analitzar Enquesta".
      5. Seleccionar: Manual(tu esculls k)
      6. Introduir valor de k (nombre de clusters): 10
      7. Seleccionar algorisme: K-Means++
      8. Clic al botó "Analitzar".
      9. Resultat esperat: Missatge d'error "K no pot ser superior al nombre de participants (K ≤ 5)".

7. Enquesta sense respostes (Cas d'error):
   - Precondicions: Existeix una enquesta 'enc_buida' sense cap resposta.
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta 'enc_buida' de la llista.
      4. Clic al botó "Analitzar Enquesta".
      5. Resultat esperat: Missatge d'error "Aquesta enquesta no té respostes. Necessites almenys 2 participants per fer clustering".

8. Enquesta amb només 1 participant (Cas d'error):
   - Precondicions: Existeix una enquesta amb només 1 resposta.
   - Accions:
      1. Login amb TestUser1 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Seleccionar l'enquesta amb 1 sol participant.
      4. Clic al botó "Analitzar Enquesta".
      5. Resultat esperat: Missatge d'error "Necessites almenys 2 participants per fer clustering. Aquesta enquesta només té 1 participant".

9. Usuari no creador intenta analitzar (Cas d'error):
   - Precondicions: TestUser2 NO és el creador de 'enc_completa'.
   - Accions:
      1. Login amb TestUser2 i password123.
      2. Clic al botó "Anàlisi de Clustering"
      3. Resultat esperat: L'enquesta 'enc_completa' (creada per TestUser1) no apareix a la llista d'enquestes disponibles per analitzar.

10. Verificar assignació de perfils als usuaris (Validació de dades):
    - Precondicions: S'ha executat una anàlisi sobre 'enc_completa' amb K=2.
    - Accions:
       1. Login amb TestUser2 i password123.
       2. Clic al botó "Veure el meu Perfil".
       3. Resultat esperat:
          - Es mostra el perfil assignat a TestUser2.
          - Es mostra a quin cluster pertany (Cluster 1 o Cluster 2).
          - Es mostra el perfil característic del seu cluster.
          - Es mostra la mètrica Silhouette del cluster.

Efectes estudiats:
- Interacció amb la GUI:
    * Selecció d'enquesta des d'una llista o taula.
    * Introducció de paràmetres: nombre de clusters (camp numèric), algorisme (combo box).
    * Mode d'optimització: selecció entre "Manual" o "Automàtic" (radio buttons).
    * Rang de K per optimització automàtica (camps numèrics: K mínim, K màxim).
    * Clic a botons: "Executar Anàlisi", "Consultar Anàlisi Existent", "Veure Resultats".

- Feedback visual:
    * Indicador de progrés durant el càlcul (barra de progrés o spinner).
    * Finestra de resultats amb format llegible i organitzat.
    * Visualització de clusters: taula o llista amb informació de cada cluster.
    * Gràfics opcionals: diagrama de barres del Silhouette per cluster.
    * Missatges d'error descriptius amb icones adequades.
    * Missatges d'èxit amb confirmació de perfils assignats.

- Càlculs i mètriques:
    * Vectorització de respostes: conversió de respostes a vectors numèrics/categòrics.
    * Execució d'algorismes de clustering: K-Means, K-Means++, K-Medoids.
    * Càlcul del coeficient Silhouette global (rang [-1, 1]):
      - S ≥ 0.7: Excel·lent (clusters ben separats i compactes)
      - 0.5 ≤ S < 0.7: Bona (estructura clara)
      - 0.25 ≤ S < 0.5: Acceptable (estructura present amb superposició)
      - 0 ≤ S < 0.25: Pobra (clusters poc definits)
      - S < 0: Molt pobra (molts punts mal assignats)
    * Càlcul del Silhouette per cada cluster individual.
    * Identificació del representant de cada cluster (usuari més proper al centroid).
    * Generació automàtica de noms descriptius per als clusters.

- Validacions:
    * Verificació que K sigui vàlid: 1 ≤ K ≤ N (nombre de participants).
    * Verificació que l'enquesta tingui almenys 2 respostes.
    * Verificació de permisos: només el creador pot analitzar l'enquesta.
    * Validació del rang de K en mode automàtic: K_min < K_max, 2 ≤ K_min, K_max ≤ N.
    * Validació que les respostes siguin vectoritzables (no buides, format correcte).

- Persistència:
    * Eliminació de perfils antics abans de generar-ne de nous (evitar duplicats).
    * Guardado de cada perfil generat a perfils/{id}.json amb totes les dades.
    * Actualització de l'índex de perfils (perfils/index.json).
    * Assignació de perfils als usuaris participants (actualització de usuaris/{username}.json).
    * Els perfils i assignacions han de ser persistents (recuperables després de reiniciar).

- Algorismes de clustering:
    * K-Means: Inicialització aleatòria, centroides calculats (mitjanes).
    * K-Means++: Inicialització inteligent, convergència més ràpida, millor qualitat.
    * K-Medoids: Utilitza punts reals del dataset com a medoides, robust a outliers.
    * Verificar que K-Medoids produeix medoides (no centroides calculats).
    * Verificar que K-Means++ sol produir millor Silhouette que K-Means estàndard.

- Optimització automàtica de K:
    * El sistema prova múltiples valors de K dins del rang especificat.
    * Calcula el Silhouette per cada valor de K.
    * Selecciona automàticament el K amb millor Silhouette.
    * Mostra la comparativa de Silhouette per cada K provada.
    * Executa l'anàlisi final amb el K òptim trobat.

- Generació de noms de clusters:
    * Els noms es generen automàticament basant-se en el centroid/medoid.
    * Format típic: descriptiu segons les respostes característiques.
    * Exemple: "Joves actius", "Majors amb salut regular", etc.

- Resultats mostrats:
    * Informació global:
      - Nombre total de clusters generats.
      - Nombre de participants analitzats.
      - Coeficient Silhouette global.
      - Algorisme utilitzat.
    * Per cada cluster:
      - Índex del cluster (1, 2, 3, ...).
      - Nom descriptiu del cluster.
      - Mida del cluster (nombre de membres).
      - Coeficient Silhouette del cluster.
      - Usuari representant (més proper al centroid).
      - Perfil característic (vector de respostes típiques).
      - Llista de membres del cluster.
    * Interpretació de la qualitat del clustering.
    * Consells per millorar la qualitat si el Silhouette és baix.

- Consulta d'anàlisi existent:
    * Permet veure anàlisis prèviament executades sense recalcular.
    * Carrega els perfils guardats de la persistència.
    * Mostra la mateixa informació que després d'executar l'anàlisi.
    * Operació ràpida (sense càlcul de clustering).
